from WassatiLib.divers.modules import getCurrentDate
# from BulletNivo.bulletPlages import getPlage
from tqdm import tqdm
import pandas as pd
import bisect

tqdm.pandas()

plages = {
        'FR_CS_C21': {
                'Droit de l’enfance': [0.016803405931095673,0.020498503890738796,0.023647471367805643,0.026429210867995274,0.0292725450978206,0.03211471712291317,0.0351027466607823,0.037684166933175105,0.04013134366508668,0.042599133380333054,0.045086808452410615,0.04756304256584484,0.05071796921553866,0.053944717503932954,0.05659427928452743,0.059848813642556925,0.06306593657392559,0.06656447083940822,0.07024215132078125,0.07380294541186759,0.07845365988563485,0.08369906202922878,0.0886021083487098,0.09739536003192723],
                'Droit des femmes': [0.009835705843370833,0.015632183776009737,0.02305855628378864,0.027820338448034897,0.031524732194889625,0.03624660984511646,0.0394464706770382,0.04313510726292635,0.04630305294247922,0.05025851650774235,0.054904649329021546,0.059939133697399394,0.06475492379611308,0.06978962202895142,0.07475531178446798,0.08236402329656839,0.08819066699898714,0.0965792994342868,0.1052453014775259,0.11509424434519513,0.12475696410084358,0.13880213459739005,0.1528510978647748,0.17151612264949112],
                'Education': [0.00834498372058119,0.01975455634321653,0.027582657041786012,0.0341689053180962,0.04077729276747028,0.04694911076440248,0.05330201353209586,0.05906035686388751,0.06492530535468725,0.07040364870347839,0.07547635346009963,0.08127921496931113,0.08637822178712778,0.09167124086704642,0.09693730245281922,0.10264228538263448,0.10813429756858056,0.11387868453154257,0.11977419986508614,0.12610574484350334,0.13329714983669222,0.141816091644967,0.1517929679249505,0.16588316788983742],
                'Environnement': [0.009160910212358628,0.012994007497360096,0.016099483560724746,0.01887251701842053,0.021511521599963362,0.024215489706285398,0.02674244467943417,0.029348468243778292,0.03204840624625112,0.03490922699363672,0.037828940805969206,0.04109058236495141,0.04407121688220318,0.047736371366024134,0.051529122654430576,0.05582250139255115,0.06056780944776516,0.06571930503858024,0.07186999383434035,0.07943636485313445,0.08920985341916754,0.1015360555659704,0.11963279988261545,0.1444522690526222],
                'Justice': [0.006225939833322044,0.009033077101366636,0.011256216768837271,0.013428657023600963,0.01518914310029966,0.01708917391334994,0.018686530334687115,0.0206469025597156,0.022147533287191594,0.02397221941741048,0.02580366861570281,0.027749378079877627,0.02954657673601946,0.03185556054190682,0.03415771471559186,0.03664342321920141,0.03955949290902117,0.04279787131942611,0.046197568221238994,0.05088932563881353,0.05539624138621244,0.06091624837920537,0.06869271146693323,0.08038959592706155],
                'Justice Economique': [0.008153522153032616,0.010933359798743337,0.01281297068617093,0.01450853290094405,0.01609262207469414,0.017488525726307796,0.01896523653289111,0.02026652194933442,0.021557733041792683,0.022894637892056133,0.02414588060462312,0.025452007075223035,0.02681451468803934,0.02833384543110072,0.029678498535273424,0.03141385988612801,0.03314910233586478,0.03491868795270218,0.03700249739242123,0.039153249304929985,0.04160384852707843,0.04512720155315297,0.04901925516574458,0.05530824026542995],
                'Mobilité': [0.009546662291917838,0.014101127114533575,0.01737203940348256,0.0202268373078138,0.023115878150428336,0.02555291162269682,0.027854923223709634,0.03046523846179633,0.03273564628533529,0.03514239583241809,0.03805555535073506,0.04064846755628026,0.04355820930747346,0.046137780828112214,0.048913946823043626,0.05153461426631795,0.05435272408055196,0.057717141761745965,0.06119650412774456,0.06484049889482915,0.06937037792015874,0.07432578382820289,0.08101079069835329,0.09023848607342946],
                'Politique': [0.007463481206642731,0.009430960259213975,0.01110103425548613,0.012878524283451287,0.014306087162533163,0.015546692270786228,0.01679063574954929,0.017999325455515275,0.019103840142720156,0.02022911569113041,0.021342524205269112,0.02241868482591042,0.023703875314101033,0.025030362092208915,0.026277864172693816,0.02758806423810926,0.028968917493045115,0.03053366366896748,0.032342819396867326,0.034316407304479546,0.036350629145111994,0.0390909050852721,0.04253825489848216,0.04771704919413215],
                'Protection Animale': [0.011149079103436123,0.01856795031580308,0.026081956119649148,0.03440291343837629,0.041186540407537685,0.04755666586287918,0.05483022801427863,0.06167286003953196,0.06979872597794909,0.07785408383139189,0.08487971934950896,0.09213463730171767,0.10027582120471198,0.10692329042460325,0.11411295370506065,0.12162685726962087,0.12966707207999173,0.13795242159215573,0.14577114880101508,0.15398036167849838,0.16229869698913799,0.171176779878123,0.18153817861704016,0.19756066845985237],
                'Santé': [0.012411406277554108,0.016277637708514557,0.01935853802013707,0.021898514056198744,0.02436593073290981,0.026612158450813855,0.02872960930709343,0.030742312937625936,0.03291279107473812,0.035189474014395004,0.037434571056631546,0.03980832395173923,0.042144013225125836,0.044530601421022095,0.046950636680947774,0.04984588281860426,0.052725886540661536,0.055892126562689985,0.05926356884858052,0.06360470773875268,0.0684535148143155,0.07355827655640843,0.08039148047141927,0.09165259463988554],
                'Santé - Précaution Ondes': [0.008057046788586923,0.011172857015285951,0.013697098278310029,0.01606719091578879,0.018125126007679605,0.020304391566205546,0.022944219337018214,0.0255238207140588,0.028083158456821692,0.031465401743459756,0.035479896568116405,0.040275665336979044,0.04562555068056008,0.05469824975372365,0.06646559431616417,0.08685440761752267,0.10535653494497965,0.11879114618707647,0.13054414419402316,0.14451358003872317,0.15552059043403765,0.1659686363866231,0.17678366827146924,0.1901941420290271],
                'Sport': [0.005972699858110425,0.008687512718038432,0.011228959569493636,0.013276225051156897,0.01579945158660191,0.01849267483291512,0.02124586813605812,0.02404964725140864,0.02688755198676749,0.029729965177774393,0.032640940108027164,0.03601324841607664,0.04030050652810869,0.04433774558223268,0.048879173923988516,0.05401653197262141,0.059247964373228136,0.06525005891946106,0.07174036341040596,0.07808851356911146,0.08458630966287806,0.0939120530206776,0.105638299180494,0.12017408708757225],
                'Vie Locale': [0.007386915299068117,0.009847957902560026,0.011892989688964444,0.013986825076680722,0.015391850568720469,0.016868061343076734,0.0183250620468432,0.019713373516624506,0.021023466546729663,0.022440742031876446,0.023796934492106264,0.02526206900711401,0.026993539145033045,0.02854337703450533,0.030099209518946624,0.031933224905267184,0.03367171483009549,0.03574185177291771,0.03772268553051823,0.04046884165113817,0.043211178989303815,0.047001366220836956,0.05202944300507803,0.05989281419556882]
                },
        'ES_CS_C20': {
                'covid19': [0.016979518826020702,0.02335245028359937,0.02785601505691333,0.031326466621494964,0.034884519815418666,0.03775351010848945,0.0405601282324301,0.0437786926776016,0.04662933038599376,0.04964114995320283,0.053025887613479344,0.05599326766562585,0.0586688464129305,0.061483920643102374,0.06452172732443125,0.06750525506151203,0.07108542815911598,0.07490235080002462,0.07848056266682474,0.0835133589420106,0.08889026228766922,0.09481112414117583,0.10193076459372992,0.1131796382842028],
                'derecho del niño': [0.015518912444550812,0.0192770808196985,0.02314041280510492,0.025974372555919764,0.029213989764300053,0.03136419418934017,0.034905142476482194,0.03720979240230262,0.039018403845122715,0.0412983808431042,0.043669885340139436,0.04661900593262865,0.04858772090906603,0.05110829598938827,0.053432924340643395,0.055175415253078605,0.05743144155206947,0.05968160534904426,0.062139900813399276,0.06458526552778379,0.0676068142931647,0.0706552012648709,0.0769552671889379,0.0813918014846228],
                'derechos de la mujer': [0.006707738195040112,0.015629739571362933,0.02266465583093219,0.028934951017644754,0.03379537157190926,0.03757186935893622,0.04017789353192486,0.04441380225987396,0.04830619932465734,0.05241033604067911,0.05743607095281075,0.062384709160049366,0.06693042501684174,0.07358339145649143,0.07863972766281968,0.08377907418432612,0.09002241686952461,0.09493008810151099,0.10126032369382071,0.10785298775322633,0.11661783694114883,0.12747862890251516,0.1377771678675049,0.15610519771345316],
                'educación': [0.02155531795489231,0.030901474407576443,0.038205946572701543,0.043811946481545086,0.04868185218617327,0.053312792294934075,0.057683055983818336,0.06202795909479876,0.06683999299429184,0.07073105976275135,0.07531540959909871,0.07975611353885895,0.08403971835021265,0.08822091867632034,0.0931674022404278,0.09803934832988406,0.10313497023594234,0.10815198753087397,0.1134246871009513,0.11960810230771705,0.12644899884297994,0.13439736858913923,0.1454385158340431,0.16013909599644083],
                'justicia': [0.010956809026965825,0.016791679857979913,0.02095802925787721,0.02465864570340287,0.02807635283086652,0.030809334322705467,0.034237696911879986,0.037356131048623745,0.04015112376643255,0.043048779154717484,0.04598054461736627,0.048424218213523246,0.05139780682252164,0.05432680520952242,0.057458585457554535,0.061747856365624076,0.06601187690636375,0.07038133521290543,0.0752383249089634,0.08106796942108184,0.08692169541382794,0.09543707803465765,0.10648921965763376,0.12230210872413974],
                'justicia económica': [0.016557240263681976,0.022703299762647886,0.027767898436276684,0.03133492078865911,0.03498086334926758,0.038825875857885966,0.04186245245170658,0.0451711734896617,0.04850083194795762,0.05163101137281641,0.05557993822536908,0.059743601226313475,0.06342133873751098,0.06755362303944687,0.07195546387386616,0.07606768705527112,0.08049282240264216,0.08576400018801468,0.09094771992017639,0.09788662563820588,0.10563771808923333,0.11446361966571299,0.12589221893444502,0.1449530230318582],
                'medio ambiente': [0.009574522321425864,0.015153346078571384,0.02013311413285835,0.024329825382763418,0.028697863092367902,0.03131885179037052,0.0342260449816222,0.03697391129660634,0.039480448436610374,0.042381970752548154,0.0449691320456282,0.04836511926965034,0.051602770514335296,0.05541529244959571,0.058734891046474905,0.06276234583462709,0.06794718486749801,0.07330176169853211,0.08048630274657402,0.08939666768185389,0.09909813020479952,0.10895752870559602,0.12029515690228577,0.1390395450634313],
                'movilidad': [0.022969675800744757,0.030450530803052843,0.037328938469824935,0.04156773735607623,0.047149164512531316,0.05102106622523613,0.055358649415704245,0.05981678019514182,0.06527089183097255,0.0712816015734994,0.07699966392761186,0.08238980827918302,0.08767377900829378,0.09250910730342336,0.09835163829947692,0.10473119245826554,0.11132937446279946,0.11734061706576765,0.12624399117552107,0.13502569193678526,0.14575513715266478,0.15767955745453635,0.17416398062905714,0.19315535723603117],
                'ocio': [0.012013545393649377,0.01811941105184869,0.02893221670220654,0.03920352925388423,0.04564308000137586,0.05224813164174668,0.05991027231059863,0.06705825172183251,0.07645718414318213,0.08314586377531658,0.08871688057417872,0.10040227532507516,0.10927430313241368,0.11609589577037022,0.12301239404619786,0.13075616392311917,0.1383246249192087,0.14374033750518583,0.1524359914108664,0.1612396730785792,0.172999404980642,0.18212071599412155,0.19753477865300303,0.2185192248184027],
                'política': [0.0,0.004311757004918683,0.011238068382100721,0.01660699513880173,0.020246561483689286,0.024125977794900343,0.0270715716411434,0.03035073555698408,0.033322343609608465,0.036520406628768924,0.04000268314292965,0.04315201511569679,0.04616529354911865,0.050293398255768514,0.05578738291316358,0.06087039755219101,0.06613781251130821,0.07195459535497352,0.07927680062332591,0.08765671792374952,0.09756381170474268,0.10931916536461453,0.12485203175471596,0.14628205836965702],
                'protección de animales': [0.012144639332415146,0.026426513785504077,0.037400335763736754,0.04410652917709786,0.050225630371122,0.05678468722273195,0.06311967873411001,0.06976217504842883,0.07495664316687815,0.08207978665239939,0.08833108613863658,0.09527174227601934,0.10179012804987413,0.10786529127191741,0.11292149145825423,0.11950198915370269,0.12608668065102266,0.13342457794170054,0.14214022327070813,0.1507421879562267,0.16158889222608813,0.17793629047167442,0.19972256851801026,0.22984895709341494],
                'salud': [0.014685295903342485,0.023822651854988094,0.03033586697605206,0.036289632079385764,0.04158782901931263,0.0457888325494778,0.05031692090563515,0.055097020858798584,0.05920956877665396,0.06282648210485192,0.06632711911548765,0.07097051400441408,0.0756923482013481,0.08066872440489076,0.08591341230918383,0.09141587968088488,0.0981186393119538,0.10383009394341544,0.11003258189212235,0.11695542782533963,0.1246207823909892,0.13389056393750526,0.14628962021148367,0.16345113457816868],
                'turismo': [0.03806298072712656,0.04399611674052011,0.04985999136217461,0.05769786141192205,0.06705347120255696,0.07114421706916832,0.08066294881441897,0.0916176076328314,0.10336093123245338,0.11272717510624009,0.12175589908777291,0.13028982586736323,0.13895514431843234,0.14319751428997204,0.14967265254866033,0.15849733425898865,0.16364452320968376,0.1706977251763205,0.17919883591219474,0.18463059681450766,0.19652179412398907,0.2038679789631339,0.21278123360444234,0.2229232082155903],
                'vida local': [0.008345690426131928,0.01347499028481058,0.016961626327588165,0.020879199997902657,0.02337807771673054,0.026461028599897837,0.02854037135727717,0.030730892262759248,0.03326361185960955,0.03554669683027054,0.03785801802888539,0.040262713047204184,0.04241593023729499,0.044827007190741515,0.047356613057022184,0.0499602230519568,0.05248341117729191,0.055622262518762275,0.05877758473777839,0.06199449683399845,0.06499537226279155,0.06955580470551137,0.07589298944588643,0.083372688314016]
                },
        'EN_CS_C21': {
                'Animal protection': [0.006717270877398554,0.013549990103627825,0.018317036885419812,0.023892045050715505,0.02634302798299396,0.03147490609991163,0.0379081620121765,0.04474105517476863,0.05169603796755923,0.05880792028330413,0.06640637735877493,0.07393076599071617,0.0817449234881757,0.08878790763483296,0.0965803604982746,0.10436637033662949,0.11134712827713944,0.11832312470122326,0.1251120592035769,0.13194973796818804,0.13917710826005003,0.14671001654974802,0.155492760706462,0.16751027145405661],
                "Children's right": [0.005225732181344746,0.01832114912336516,0.023474892856427784,0.02787441145723268,0.0319431409179797,0.03587868604712516,0.03976747834557579,0.043650451063493675,0.04782694090604265,0.05194376543899854,0.05620725944146819,0.06061972375274437,0.0654371185423328,0.06945412983378216,0.0749359382517884,0.08010208344369439,0.08557136874785816,0.09145926869228464,0.09765611206396926,0.10461294787250311,0.1123902980835544,0.12252853110996073,0.13619335342428196,0.1554735376626996],
                'City': [0.006821993259079297,0.009579135680111187,0.01166658066116967,0.013791247527770816,0.015597486138516196,0.01768505487347845,0.01941710341431278,0.021321315669682303,0.023197169898259182,0.025144822213526825,0.02715787996444447,0.02907894761002216,0.031238288207660225,0.03333898901628006,0.03565647202416059,0.03829825892185819,0.040847950118355986,0.043895066399385445,0.04719782023222073,0.05122573447885494,0.05652675879433491,0.06318438746424523,0.07260072334110591,0.08704585484286177],
                'Covid': [0.006162269915244846,0.010418291760888506,0.013467128080576927,0.015510803109708256,0.01762383856457943,0.020011807001268,0.022166960651154005,0.024038224266301932,0.025985257175751793,0.02794382975849517,0.029954445964706568,0.03184583976914641,0.03367932568740026,0.03555585899028701,0.0376056138538109,0.03968540608194763,0.04167868749603777,0.044150057751729824,0.04679622134100946,0.049968112641730095,0.0538769408142599,0.058296455150001175,0.06404553052804324,0.07199030907327772],
                'Economic Justice': [0.007026428029850115,0.009837273263543604,0.01185673238443859,0.013696032016686111,0.015517726964015448,0.017170980911681608,0.01874178797386035,0.020265492780432878,0.021653067420293437,0.02323120056543964,0.024715266204381265,0.026447474511544243,0.02820262898695171,0.029959043242702106,0.031838993810065254,0.033839613295891025,0.03599173294070335,0.0384356347076091,0.0412028741547821,0.04433425187058624,0.048479018163290394,0.053363167402294034,0.05792513157982629,0.06616726913005319],
                'Education': [0.0,0.0,0.0,0.0,0.0,0.005767535248861484,0.024534764076827708,0.03483266374328964,0.04360664009229093,0.051302788608727584,0.058330207693698254,0.06491112396452747,0.07101710824753779,0.07704347305363282,0.08342802098655025,0.0892843567554922,0.09519204890999555,0.1014353080795848,0.10788909666194565,0.11507261355882129,0.12273976951907814,0.13144971161439023,0.14221996485274627,0.15657482240670434],
                'Entertainment': [0.005859087475201522,0.006970332650606884,0.0087645109276903,0.011314425369599325,0.013220429111477108,0.014651584452605235,0.017097005211037828,0.019349804677234815,0.02232423619088575,0.0249450362892829,0.02824772715622919,0.0317743364192073,0.034573227489651776,0.03660124422354881,0.03880494006169767,0.04233152938824527,0.04688931710970785,0.05120519405633965,0.05684764684276728,0.0637370118201945,0.07158823147658747,0.08176312046094866,0.09309988332768604,0.1099219024166239],
                'Environment': [0.0044835194845732965,0.006318366323993691,0.008640034785811589,0.011049160104107562,0.013463695203887297,0.015256895360178262,0.016789540443786808,0.018662227410838297,0.020579942010261545,0.022233444859958894,0.024162835735497608,0.026240247901968612,0.028569808793932498,0.030806381142693084,0.03289643290888416,0.03574640697223498,0.03847345739939355,0.04185168442550294,0.04564920791463498,0.05118350597221931,0.052762681811073506,0.07049391514338996,0.09733687650185653,0.12034214270694202],
                'Justice': [0.004682332195336784,0.00642742575630185,0.009522994565596752,0.012500472056058264,0.015064432504215805,0.017407594112396587,0.020002647080952295,0.022574883687998537,0.02512318022948466,0.02768271220960521,0.030133615427089852,0.03323052154754939,0.03607943369340964,0.03934676214104195,0.04269690916782001,0.046194125328792676,0.04989831011337524,0.05399582746759092,0.0584148527889715,0.06316222457320636,0.06827108523763989,0.07457483799306433,0.08256180524804253,0.09384590239810711],
                'Politics': [0.006187388713154187,0.010036108510762774,0.012428969906185559,0.014838750821941787,0.01715877504405684,0.019133210389023356,0.021125353048002636,0.023020416433863468,0.025111133141493658,0.027247990776425857,0.029337887270211856,0.03157406925856478,0.03387711975726909,0.036194235898770466,0.038664422208245605,0.04130869067951793,0.04354529801202764,0.04699594919323788,0.050883975270928854,0.05528322212596059,0.060852696154990005,0.06607833227136543,0.0750968418344615,0.08989393727640636],
                'Sport': [0.010846460392363984,0.018345210959662715,0.02364464897261787,0.027928297923724237,0.03213539517358266,0.03594540444277035,0.03985414077471325,0.0433206450236196,0.047655541112507846,0.051502079378388174,0.05530153463082167,0.059897569456013273,0.06403451593426203,0.06929804523425262,0.07490380474235901,0.07803316039259142,0.0847646670528802,0.09078882584614918,0.0977132534392569,0.10582704974860345,0.11493223261418749,0.12493446177384,0.1371679747354981,0.15300953264559916],
                "Women's right": [0.00814489314636738,0.009001606418981591,0.012253251613260118,0.016671638031857484,0.020368388589327838,0.023737432167436803,0.027069459176622897,0.03068503873882719,0.03198319256656918,0.035530805456149075,0.03926804248514712,0.04241331164375815,0.04619808810100006,0.05009465013123757,0.05412289261612625,0.058292313522153714,0.06280957826897271,0.06606879822565784,0.07210621407888447,0.07707685347523521,0.08657357155676183,0.09603689531252063,0.10740746196764334,0.11981958025126774]
                }
        }


def getPlage(cs):
        return plages[cs]

def getBulletScore(data):
    id, theme, score = data
    print(id, score)
    
    language = id[3:5]

    if language == 'fr':
        id_cs = 'FR_CS_C21'
    elif language == 'es':
        id_cs = 'ES_CS_C20'
    else:
        id_cs = 'EN_CS_C21'

    plages = getPlage(id_cs)
    return bisect.bisect(plages[theme], score) + 1


filename = f"processed_petitions/brevets_algerie_processed_{getCurrentDate(['year', 'month'])}.csv"
output = f"processed_petitions/brevets_algerie_predicted_bulletscore_{getCurrentDate(['year', 'month'])}.csv"

df = pd.read_csv(filename)

df['bullet_score'] = df[['id','dominant topic', 'dominant score']].apply(getBulletScore, axis= 1)
df.to_csv(output, index= False)